<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="somnus">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="somnus">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="somnus">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"Sidebar Position, available value":"left | right (only for Pisces | Gemini).","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/">





  <title>somnus</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  

  <div class="container  
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">somnus</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/23/SA-system-design-specification/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/23/SA-system-design-specification/" itemprop="url">SA_system_design_specification</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-23T20:46:34+08:00">
                2019-01-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Assignment3-design-patterns"><a href="#Assignment3-design-patterns" class="headerlink" title="Assignment3 design patterns"></a>Assignment3 design patterns</h1><h1 id="Aim"><a href="#Aim" class="headerlink" title="Aim"></a>Aim</h1><p>项目实现了一个图书管理系统的设计和原型，目的是满足基本需求，并且在设计中遵守设计模式的原则，使系统易用、易修改。</p>
<h1 id="Content-description"><a href="#Content-description" class="headerlink" title="Content description"></a>Content description</h1><h2 id="components-description"><a href="#components-description" class="headerlink" title="components description"></a>components description</h2><ol>
<li><p>对不同用户提供不同借书方法，并且可以调整、添加新的借书方法。使用策略模式，将借书这一行为从用户中抽离出来，可以在运行时更改行为。用户持有策略接口，运行时动态选择使用的策略。</p>
<p>选择原因：</p>
<ul>
<li>借书方法可以自由切换，以应对新借书方法的产生</li>
<li>易于扩展，可以在不改变原有代码的基础上新增借书方法，符合开闭原则</li>
<li>代替了条件语句，用户只需要知道自己需要选择的策略，而通过条件判断是不容易维护的。</li>
</ul>
<p>类图：</p>
<p><img src="..\images\strategy.png" alt="strategy"></p>
</li>
<li><p>图书管理员编辑图书、用户信息、产生借书、逾期报告。使用访问者模式，根据管理员查看的用户类型来改变查看的方法，不同的用户产生不同的借书、逾期报告。用户接受访问者对象，访问者对象处理对用户的操作。</p>
<p>选择原因：</p>
<ul>
<li>增加查看新用户类型的信息方便，只需增加一个具体用户类，符合开闭原则。</li>
<li>将有关元素对象的访问行为集中到一个访问者对象中，而不是分散在一个个的元素类中。类的职责更加清晰，有利于对象结构中元素对象的复用，相同的对象结构可以供多个不同的访问者访问。</li>
<li>在不修改现有用户类层次结构的情况下，定义作用于该层次结构的操作。</li>
</ul>
<p>类图：</p>
<p><img src="..\images\visitor.png" alt="visitor"></p>
<p>管理员向其他部门、学校授予查看、增加用户信息的权限，使用条件模式来对其他部门查看用户进行条件过滤，图书管理系统中记录的用户中只有一部分是其他部门需要查看的，不同部门需要查看的用户群体不同，使用不同的条件过滤一组对象，并通过逻辑操作以解耦方式将其链接。向部门授权使用用户、角色、权限来实现，每个部门有一个权限集合，管理员对权限信息进行操作，来进行权限的授予和取消。</p>
<p>选择原因：</p>
<ul>
<li>符合开闭原则，在有新的部门需要查看一组特别的用户信息时，只需要新扩展一个criteria即可。</li>
<li>解除了部门和用户信息之间的耦合，让criteria专门进行用户筛选</li>
</ul>
<p>类图：</p>
<p><img src="..\images\criteria.png" alt="criteria"></p>
</li>
</ol>
<h1 id="feelings-and-comments"><a href="#feelings-and-comments" class="headerlink" title="feelings and comments"></a>feelings and comments</h1><p>分工 </p>
<p>​    刘倚彤：component1、component2设计、类图、原型</p>
<p>​    蔡蔚霖：component3、component4设计、类图、原型</p>
<ul>
<li><p>刘倚彤</p>
<p>对于同一功能，我们可以选择不同的设计模式来实现，甚至不使用设计模式，但是好的设计模式的应用可以提高系统的质量属性。在选择设计模式时不应该只考虑设计模式的优点，应该发现这样的设计模式会对系统带来可能的一些负担和问题，因为这些问题在暴露出来的时候可能因为已经选用了设计模式所以难以割舍，而且往往弊大于利。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/20/pig/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/20/pig/" itemprop="url">pig</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-20T22:17:40+08:00">
                2019-01-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="windows构建pig"><a href="#windows构建pig" class="headerlink" title="windows构建pig"></a>windows构建pig</h1><p>clone或下载源码：<a href="https://github.com/apache/pig/tree/branch-0.17，下载ant并配置环境变量，下载Hadoop并配置环境变量，在pig的顶级目录执行ant，参考https://wiki.apache.org/pig/BuildPig" target="_blank" rel="noopener">https://github.com/apache/pig/tree/branch-0.17，下载ant并配置环境变量，下载Hadoop并配置环境变量，在pig的顶级目录执行ant，参考https://wiki.apache.org/pig/BuildPig</a></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>ant编译卡在ivy-resolve不动，找到两个解释：</p>
<ul>
<li><p>maven仓库文件损坏，应修改maven远程仓库（settings.xml）。</p>
</li>
<li><p>ivy工具使用的库在国外，这里我在编译的时候开了vps，但是还是卡住不动，但是使用境外服务器是可以编译的，可能ivy工具构建时绕过了vps代理。</p>
<p>参考：<a href="https://ask.csdn.net/questions/163160" target="_blank" rel="noopener">https://ask.csdn.net/questions/163160</a></p>
</li>
</ul>
<h1 id="ubuntu构建pig"><a href="#ubuntu构建pig" class="headerlink" title="ubuntu构建pig"></a>ubuntu构建pig</h1><ol>
<li><p>下载ant：</p>
<p>wget <a href="http://mirror.olnevhost.net/pub/apache//ant/binaries/apache-ant-1.10.5-bin.tar.gz" target="_blank" rel="noopener">http://mirror.olnevhost.net/pub/apache//ant/binaries/apache-ant-1.10.5-bin.tar.gz</a></p>
<p>tar -xvzf apache-ant-bin.tar.gz</p>
</li>
<li><p>下载pig源码：</p>
<p>git clone <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:apache/pig.git  </p>
</li>
<li><p>用git剪出一个新分支，并且pull远程0.17分支的版本</p>
<p>参考<a href="http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html</a></p>
</li>
<li><p>编写一个build.sh脚本：</p>
<p>vim build.sh</p>
<p>#指定maven repo源<br>IVY_MIRROR_PROP=${IVY_MIRROR_PROP:-<a href="http://cloud.sogou-inc.com/nexus/content/groups/public/}" target="_blank" rel="noopener">http://cloud.sogou-inc.com/nexus/content/groups/public/}</a></p>
<p>#指定ant home<br>export ANT_HOME=/search/apache-ant-1.10.5<br>export PATH=${ANT_HOME}/bin:$PATH</p>
</li>
<li><p>#修改build.xml,编译jar包<br>ant -Dmvnrepo=$IVY_MIRROR_PROP  -Dhbaseversion=94 -Dhadoopversion=23 -Djvm.arg=… piggybank tar</p>
<p>其中-Djvm-arg即agent位置，修改build.xml参考<a href="https://monsoongale.iteye.com/blog/1028920" target="_blank" rel="noopener">https://monsoongale.iteye.com/blog/1028920</a></p>
</li>
<li><p>执行脚本</p>
<p>sh build.sh</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/01/07/architecture-patterns/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/07/architecture-patterns/" itemprop="url">architecture-patterns</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-01-07T16:16:05+08:00">
                2019-01-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/23/quality-attribute/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/23/quality-attribute/" itemprop="url">quality_attribute</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-23T10:34:55+08:00">
                2018-12-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1>Assignment1</h1>

<h2 algin="center">南京大学软件学院2016级本科</h2>

<p align="right">161250081刘倚彤</p>

<p>[TOC]</p>
<h1 id="extensibility-vs-scalability"><a href="#extensibility-vs-scalability" class="headerlink" title="extensibility vs scalability"></a>extensibility vs scalability</h1><h2 id="1-scenarios"><a href="#1-scenarios" class="headerlink" title="1. scenarios"></a>1. scenarios</h2><h3 id="extensibility"><a href="#extensibility" class="headerlink" title="extensibility"></a>extensibility</h3><ul>
<li>general scenario</li>
</ul>
<table>
<thead>
<tr>
<th>element</th>
<th>values</th>
</tr>
</thead>
<tbody>
<tr>
<td>source</td>
<td>同类产品、市场、软件订购方、交互设备</td>
</tr>
<tr>
<td>stimulus</td>
<td>同类产品有新功能；订购方、市场产生新需求；交互设备更新换代</td>
</tr>
<tr>
<td>artifact</td>
<td>添加新功能的系统；与更新的设备交互的接口</td>
</tr>
<tr>
<td>environment</td>
<td>产品已上线；产品目前功能不满足新的需要</td>
</tr>
<tr>
<td>response</td>
<td>添加新功能至满足需求；添加新接口与更新的设备交互</td>
</tr>
<tr>
<td>response measure</td>
<td>添加的新特性数量/需求变更数量；平均添加新功能所用时间；</td>
</tr>
</tbody>
</table>
<ul>
<li><p>sample scenario</p>
<p><img src="../images/10.png" alt="1545634619091"></p>
<p><img src="C:\Users\84979\AppData\Roaming\Typora\typora-user-images\1545635275133.png" alt="1545635275133"></p>
</li>
</ul>
<h3 id="scalability"><a href="#scalability" class="headerlink" title="scalability"></a>scalability</h3><ul>
<li><p>general scenario</p>
<p>| element          | values                                                       |<br>| —————- | ———————————————————— |<br>| source           | 用户、市场、政策                                             |<br>| stimulus         | 用户数量增加；市场需求量增大；政策变更导致需要额外保存数据   |<br>| artifact         | 数据库；计算服务器                                           |<br>| environment      | 正常运行；死锁；过载运行                                     |<br>| response         | 记录错误；添加数据库或修改数据库设计来应对数据库容量不足；扩展数据库存储其他数据 |<br>| response measure | 可能并发的用户数、连接数；最大存储数据量；                   |</p>
</li>
<li><p>sample scenario</p>
<p><img src="C:\Users\84979\AppData\Roaming\Typora\typora-user-images\1545639354504.png" alt="1545639354504"></p>
<p><img src="C:\Users\84979\AppData\Roaming\Typora\typora-user-images\1545640005397.png" alt="1545640005397"></p>
</li>
</ul>
<h2 id="2-relationships-and-differences"><a href="#2-relationships-and-differences" class="headerlink" title="2. relationships and differences"></a>2. relationships and differences</h2><p>extensibility（可扩展性）和scalability（可伸缩性）的共同点在于软件当前运行没有问题的假设下，考虑到了未来的变化会对现有系统带来的影响，并将这些考虑应用到实际的软件结构设计中，构造可扩展或可伸缩的系统。可扩展性的关注点是应对功能增加，同时最大限度地减少对现有系统功能的影响，在新功能添加时，可扩展的系统d的内部结构和数据流受到的影响要尽可能地小。比如随着环境的变化产生的新的功能需求，或者这个软件依赖的其他软件的接口、其他设备、输入数据发生了改变，在可扩展性设计原则下要让软件能够轻松应对这些变化，不进行过多的重构。可伸缩性是系统，网络或流程处理越来越多的工作的能力，或者是为了适应这种增长而扩大其潜力的能力。可伸缩性的关注点则是当软件的工作量急剧增加时，系统能否不进行重新设计，保持有效性能，比如某个管理系统，在用户不断增长的情况下，仍然可以保证一定的效率并且支持新增的用户，而且不需要重新编译和修改原始源代码。又如可扩展的在线事务处理系统或数据库管理系统是可以升级以通过添加新的处理器、设备和内存来处理更多事务的系统，并且可以在不关闭它的情况下容易、透明地升级。总体来说，可扩展性好的系统可以十分方便地增加新功能，可伸缩性则是系统能够调节大小来适应原有的某个功能的规模的变化。这就是二者的主要区别。</p>
<h2 id="3-strategies-and-tactics"><a href="#3-strategies-and-tactics" class="headerlink" title="3. strategies and tactics"></a>3. strategies and tactics</h2><ul>
<li>extensibility<ul>
<li>S1:将系统分解为comprehensible units，提高内聚降低耦合<ul>
<li>T1:组件化开发模式，用具有完备功能的组件实现功能。</li>
<li>T2:用声明式构建语言构建系统，提供默认的构建生命周期，也可以自己定义任务，单独运行任务，定义任务间的依赖 （gradle）</li>
</ul>
</li>
<li>S2:定义良好的接口<ul>
<li>T3:依赖倒置、OCP原则，支持通过添加进行变更</li>
<li>T4:以小步骤实现功能，减少各模块之间的依赖</li>
</ul>
</li>
</ul>
</li>
<li>scalability<ul>
<li>S3:垂直伸缩<ul>
<li>T5:使用性能更高的服务器</li>
<li>T6:使用优化更好的数据库</li>
<li>T7:使用性价比更高的调度算法来实现负载均衡</li>
</ul>
</li>
<li>S4:水平伸缩<ul>
<li>T8:使用分布式服务器</li>
<li>T9:使用缓存</li>
<li>T10:使用可伸缩数据库</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>extensibility</th>
<th>scalability</th>
</tr>
</thead>
<tbody>
<tr>
<td>T1</td>
<td>提高可扩展性</td>
<td>不同组件的伸缩性差异难以统一配置</td>
</tr>
<tr>
<td>T2</td>
<td>提高可扩展性</td>
<td>不影响可伸缩性</td>
</tr>
<tr>
<td>T3</td>
<td>提高可扩展性</td>
<td>不影响可伸缩性</td>
</tr>
<tr>
<td>T4</td>
<td>提高可扩展性</td>
<td>每一步的设计都需要考虑可伸缩性</td>
</tr>
<tr>
<td>T5</td>
<td>不影响可扩展性</td>
<td>提高可伸缩性</td>
</tr>
<tr>
<td>T6</td>
<td>不影响可扩展性</td>
<td>提高可伸缩性</td>
</tr>
<tr>
<td>T7</td>
<td>扩展新功能可能会影响调度算法</td>
<td>提高可伸缩性</td>
</tr>
<tr>
<td>T8</td>
<td>不影响可扩展性</td>
<td>提高可伸缩性</td>
</tr>
<tr>
<td>T9</td>
<td>需要扩展的功能与缓存可能发生冲突</td>
<td>提高可伸缩性</td>
</tr>
<tr>
<td>T10</td>
<td>扩展新功能可能会重构数据库</td>
<td>提高可伸缩性</td>
</tr>
</tbody>
</table>
<h1 id="stability-vs-reliability"><a href="#stability-vs-reliability" class="headerlink" title="stability vs reliability"></a>stability vs reliability</h1><h2 id="1-scenarios-1"><a href="#1-scenarios-1" class="headerlink" title="1.scenarios"></a>1.scenarios</h2><h3 id="stability"><a href="#stability" class="headerlink" title="stability"></a>stability</h3><ul>
<li><p>general scenario</p>
<p>| element          | values                                     |<br>| —————- | —————————————— |<br>| source           | 程序、硬件、用户                           |<br>| stimulus         | 程序性错误、异常；硬件出错；用户误操作     |<br>| artifact         | 软硬件接口、软件系统                       |<br>| environment      | 正常运行、过载、死锁                       |<br>| response         | 修复问题，记录日志，继续运行               |<br>| response measure | 正常运行时间/总时间；误操作次数/总操作次数 |</p>
</li>
<li><p>sample scenario</p>
<p><img src="C:\Users\84979\AppData\Roaming\Typora\typora-user-images\1545706794793.png" alt="1545706794793"></p>
<p><img src="C:\Users\84979\AppData\Roaming\Typora\typora-user-images\1545731575418.png" alt="1545731575418"></p>
</li>
</ul>
<h3 id="reliability"><a href="#reliability" class="headerlink" title="reliability"></a>reliability</h3><ul>
<li><p>general scenario</p>
<p>| element          | values                                                    |<br>| —————- | ——————————————————— |<br>| source           | 程序、硬件                                                |<br>| stimulus         | 程序性错误、异常；硬件出错；                              |<br>| artifact         | 计算部件                                                  |<br>| environment      | 正常运行、过载、死锁                                      |<br>| response         | 纠正错误；暂停程序报告错误                                |<br>| response measure | 在给定时间t内产生正确输出的频率；隔离故障停止程序所需时间 |</p>
</li>
<li><p>sample scenario</p>
<p><img src="C:\Users\84979\AppData\Roaming\Typora\typora-user-images\1545732558166.png" alt="1545732558166"></p>
<p><img src="C:\Users\84979\AppData\Roaming\Typora\typora-user-images\1545732876068.png" alt="1545732876068"></p>
</li>
</ul>
<h2 id="2-relationships-and-differences-1"><a href="#2-relationships-and-differences-1" class="headerlink" title="2. relationships and differences"></a>2. relationships and differences</h2><p>stability（稳定性）与reliability（可靠性）的共同点在于二者的衡量标准都是系统变化，而且往往是系统产生了故障、错误等预料之外的变化，系统通过采用不同的手段了应对错误，其稳定性与可靠性也不同。稳定性表征系统对系统发生变化时的敏感性，系统产生了错误数据、硬件出错等问题，系统是否将这些问题暴露出来给用户，稳定性强的系统会展示更少的崩溃次数，系统内部消化错误，然而这种处理手段往往会使系统变得不可靠，比如系统发现了有可能会产生冲突的数据包，决策不向用户报告错误而自行选择可能的解决方案，稳定性的增强带来了可靠性的降低；稳定性也会影响可伸缩性，稳定性强的系统用户便不会因为接收到了错误而重复操作，用户执行更少的任务，意味着系统可以支持更多的用户。可靠性与可用性、可维护性共称为RAS，使用更高级别的RAS设计的计算机具有许多保护数据完整性的功能，并帮助它们长时间保持可用而不会出现故障，可靠性的定义为系统在某个给定时间<em>t内</em>产生正确输出的概率。可靠性强的系统只执行绝对正确的指令，在遇到错误时，往往会暂时停止程序或者程序的一部分，直到错误修复，基于互联网的系统便基于可靠性工作，在出现网络连接中断时停止功能的使用，立即备份数据，在网络恢复后，我们可以依靠它不丢失数据，这样的设计似乎违反了稳定性，但是它十分可靠。再比如一个运算器，接收到了除0的运算，可靠性的设计认为这样的结果是错误的，应该抛出异常，中断运算，而稳定性的设计则会为了尽量展示更少的崩溃次数，返回一个用inf表示的特殊结果。综上所述，稳定性与可靠性的差异便在于系统应对错误的处理方式。提高一方的同时势必会影响到另一方。</p>
<h2 id="3-strategies-and-tactics-1"><a href="#3-strategies-and-tactics-1" class="headerlink" title="3. strategies and tactics"></a>3. strategies and tactics</h2><ul>
<li>stability<ul>
<li>S1:提高系统性能<ul>
<li>T1:使用更加可靠的硬件设备，减少硬件出错的频率</li>
<li>T2:减少任务执行时间，提供更多的可用资源，防止多用户同时执行产生的死锁和资源争用</li>
</ul>
</li>
<li>S2:提高系统的可伸缩性<ul>
<li>T3:减少因为系统过载所产生的错误，拒绝请求等不稳定行为。</li>
<li>T4:增加系统并行能力，减少排队请求带来的性能降低，增强稳定性。</li>
</ul>
</li>
</ul>
</li>
<li>reliability<ul>
<li>S1:硬件功能<ul>
<li>T5:处理器指令错误检测和指令重试，减少出现指令级故障的可能性。</li>
<li>T6:内存组件和内存总线的奇偶校验，禁用坏块，记忆擦洗，记忆保留，糟糕的页面离线，冗余位转向，冗余独立存储器阵列，用于防止内存故障带来的程序性错误。</li>
<li>T7:用于数据传输/重试和数据存储的循环冗余校验，用于防止I/O传输时的数据错误。</li>
<li>T8:磁盘存储的RAID配置，崩溃后的日志记录系统，数据校验和后台清理，用于检查数据错误，记录日志。</li>
<li>T9:复制组件防止单点故障（电源），时钟频率、温度、电压的指定工作范围监控例程，用于在可能发生故障时中断程序。</li>
</ul>
</li>
<li>S2：软件功能<ul>
<li>T10:丢弃网络传输中冲突的数据包，报告错误并重新请求数据</li>
<li>T11:组件化设计模式，将一个大型系统分解，更容易定位故障并修复</li>
<li>T12:可维护性的独立服务处理器，远程监控、警报和控制故障</li>
</ul>
</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th>stability</th>
<th>reliability</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">T1</td>
<td>提高稳定性</td>
<td>减少故障发生概率，提高了可靠性</td>
</tr>
<tr>
<td style="text-align:left">T2</td>
<td>提高稳定性</td>
<td>不影响可靠性</td>
</tr>
<tr>
<td style="text-align:left">T3</td>
<td>提高稳定性</td>
<td>减少了错误的发生，提高可靠性</td>
</tr>
<tr>
<td style="text-align:left">T4</td>
<td>提高稳定性</td>
<td>并行可能带来的并发错误，降低了可靠性</td>
</tr>
<tr>
<td style="text-align:left">T5</td>
<td>指令错误与重试会增加崩溃次数，降低了稳定性</td>
<td>提高可靠性</td>
</tr>
<tr>
<td style="text-align:left">T6</td>
<td>数据校验出错，系统崩溃，降低了稳定性</td>
<td>提高可靠性</td>
</tr>
<tr>
<td style="text-align:left">T7</td>
<td>数据校验出错，系统崩溃，降低了稳定性</td>
<td>提高可靠性</td>
</tr>
<tr>
<td style="text-align:left">T8</td>
<td>磁盘出错，系统崩溃，降低了稳定性</td>
<td>提高可靠性</td>
</tr>
<tr>
<td style="text-align:left">T9</td>
<td>硬件故障带来系统崩溃，降低了稳定性</td>
<td>提高可靠性</td>
</tr>
<tr>
<td style="text-align:left">T10</td>
<td>数据错误停止当前操作重传数据，降低了稳定性</td>
<td>提高可靠性</td>
</tr>
<tr>
<td style="text-align:left">T11</td>
<td>不影响稳定性</td>
<td>提高可靠性</td>
</tr>
<tr>
<td style="text-align:left">T12</td>
<td>独立处理器带来的停止系统，降低了稳定性</td>
<td>提高可靠性</td>
</tr>
</tbody>
</table>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/12/20/seam/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/20/seam/" itemprop="url">seam</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-12-20T23:14:26+08:00">
                2018-12-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="seam构建"><a href="#seam构建" class="headerlink" title="seam构建"></a>seam构建</h2><h3 id="仓库问题"><a href="#仓库问题" class="headerlink" title="仓库问题"></a>仓库问题</h3><p>seam2.2以下均使用ant管理，2.3使用maven，在seam源码中的readme可以看到要构建seam需要安装jboss-as，然后mvn clean install，然而在mvn clean install时一直找不到pom.xml中的依赖（dom4j-brew)，dom4j在maven中央仓库中便有，也很常见，然而dom4j-brew缺不在中央仓库中，查了下应该在<a href="https://repository.jboss.org/nexus/content/groups/public-jboss/这个仓库里。顺便了解了下远程仓库的机制。" target="_blank" rel="noopener">https://repository.jboss.org/nexus/content/groups/public-jboss/这个仓库里。顺便了解了下远程仓库的机制。</a></p>
<p>当我们执行 Maven 构建命令，Maven 依赖库按以下顺序进行搜索：</p>
<ul>
<li>第1步 - 搜索依赖本地资源库，如果没有找到，跳到第2步，否则，如果找到那么会做进一步处理。</li>
<li>第2步 - 搜索依赖中央存储库，如果没有找到，则从远程资源库/存储库中，然后移动到步骤4，否则如果找到，那么它下载到本地存储库中，以备将来参考使用。</li>
<li>第3步 - 如果没有提到远程仓库，Maven 则会停止处理并抛出错误（找不到依赖库）。</li>
<li>第4步 - 远程仓库或储存库中的搜索依赖，如果找到它会下载到本地资源库以供将来参考使用，否则 Maven 停止处理并抛出错误（找不到依赖库）。</li>
</ul>
<p>回到seam官方文档，发现已经提出需要设置settings.xml来设置用于构建seam的maven远程仓库，并且提供了settings.xml，问题解决</p>
<h3 id="javadoc构建检查"><a href="#javadoc构建检查" class="headerlink" title="javadoc构建检查"></a>javadoc构建检查</h3><p>seam2.3是java 5的项目，对javadoc要求不严格，项目中也有不按doc编程的例子，用java 8进行构建时会报出以下错误，需要跳过严格检查过程。</p>
<p><img src="C:\Users\84979\AppData\Roaming\Typora\typora-user-images\1545320362141.png" alt="1545320362141"></p>
<h2 id="JBoss-as"><a href="#JBoss-as" class="headerlink" title="JBoss-as"></a>JBoss-as</h2><p>运行jboss instance报错。替换modules.jar</p>
<p><a href="https://stackoverflow.com/questions/48403832/javax-xml-parsers-factoryconfigurationerror-running-jboss-as-7-1-with-java-7-upd" target="_blank" rel="noopener">https://stackoverflow.com/questions/48403832/javax-xml-parsers-factoryconfigurationerror-running-jboss-as-7-1-with-java-7-upd</a></p>
<p>jboss支持jdk1.7及以下版本，要修改standlone.bat来指定版本，同样，运行测试也需要修改java_home</p>
<h2 id="test"><a href="#test" class="headerlink" title="test"></a>test</h2><p>指令：</p>
<blockquote>
<p>mvn clean test -Darquillian=jbossas-managed-7</p>
</blockquote>
<p>Please include at least 1 Deployable Container on your Classpath</p>
<p><a href="https://stackoverflow.com/questions/42784861/how-to-add-a-deployable-container-to-my-class-path" target="_blank" rel="noopener">https://stackoverflow.com/questions/42784861/how-to-add-a-deployable-container-to-my-class-path</a></p>
<p><a href="https://stackoverflow.com/questions/39246595/cdi-api-version-mismatch-error-when-trying-to-run-arquillian-getting-started-exa" target="_blank" rel="noopener">https://stackoverflow.com/questions/39246595/cdi-api-version-mismatch-error-when-trying-to-run-arquillian-getting-started-exa</a></p>
<p>deploy</p>
<p><a href="https://stackoverflow.com/questions/38507794/duplicateserviceexception-jboss-server" target="_blank" rel="noopener">https://stackoverflow.com/questions/38507794/duplicateserviceexception-jboss-server</a></p>
<p><a href="https://access.redhat.com/documentation/ja-jp/jboss_enterprise_application_platform/6/html/migration_guide/debug_and_resolve_seam_22_booking_archive_deployment_errors_and_exceptions" target="_blank" rel="noopener">https://access.redhat.com/documentation/ja-jp/jboss_enterprise_application_platform/6/html/migration_guide/debug_and_resolve_seam_22_booking_archive_deployment_errors_and_exceptions</a></p>
<p>arquillian</p>
<p><a href="https://github.com/arquillian/arquillian-cube/issues/661" target="_blank" rel="noopener">https://github.com/arquillian/arquillian-cube/issues/661</a></p>
<h1 id="surefire"><a href="#surefire" class="headerlink" title="surefire"></a>surefire</h1><p>Maven运行测试用例时，是通过调用maven的surefire插件并fork一个子进程来执行用例的，所以这里可以在surefire插件的配置中直接添加jvm参数</p>
<p><a href="https://blog.csdn.net/wang67712640/article/details/78092804" target="_blank" rel="noopener">https://blog.csdn.net/wang67712640/article/details/78092804</a></p>
<p>为seam项目中的每个module的pom.xml创建一个build标签，并在其中添加surefire配置。</p>
<h1 id="groovy-test-task"><a href="#groovy-test-task" class="headerlink" title="groovy test task"></a>groovy test task</h1><p>gradle同样也有类似maven的fork策略，如</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">compileTestGroovy &#123;</span><br><span class="line">    groovyOptions.fork(<span class="string">memoryMaximumSize:</span> groovycTest_mx)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在测试时要在test任务中添加jvm参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">test&#123;</span><br><span class="line">	jvmArgs &apos;-agentpath:C:\\Users\\84979\\Desktop\\code_analysis\\data_dependency_capturer\\x64\\Release\\data_dependency_capturer.dll&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="class-signature问题"><a href="#class-signature问题" class="headerlink" title="class_signature问题"></a>class_signature问题</h2><p>gradle的编译策略是有一个sourceSet指定所有的test文件位置，将其编译为class文件，所以产生的class_signature没有共同前缀，如图：</p>
<p><img src="C:\Users\84979\AppData\Roaming\Typora\typora-user-images\1547358654474.png" alt="1547358654474"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/11/08/LR(1)parser/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/08/LR(1)parser/" itemprop="url">LR(1) parser</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-11-08T13:50:11+08:00">
                2018-11-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="lab2实验报告"><a href="#lab2实验报告" class="headerlink" title="lab2实验报告"></a>lab2实验报告</h1><h1 id="Motivation-Aim"><a href="#Motivation-Aim" class="headerlink" title="Motivation/Aim"></a>Motivation/Aim</h1><ul>
<li>使用LR语法分析技术分析一个满足LR的上下文无关文法，构造其LR（1）DFA和LR（1）parsing table，然后基于parsing table编程，目的是可以接受一个token输入流，输出对应的规约序列和语法分析树。</li>
<li>实现慌恐模式的错误恢复。</li>
</ul>
<h1 id="Content-description"><a href="#Content-description" class="headerlink" title="Content description"></a>Content description</h1><ul>
<li>文法使用如图的文法，该文件具有二义性</li>
</ul>
<p><img src="../images/2.png" alt="1541657491765"></p>
<ul>
<li>DFA、parsing table详见相关FA描述</li>
<li>syntactic parser，语法分析程序，接受token序列，结合上述文法的parsing table，进行语法分析，输出规约序列，最终产生一个语法分析树。</li>
<li>错误处理例程，用来处理token序列中可能产生的错误输入。</li>
</ul>
<h1 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h1><ul>
<li>LR（1）DFA的构造（见core algorithms）</li>
<li>LR（1）parsing table的构造（见core algorithms）</li>
<li>悬空else的处理，对每个else stmt结构，采用最近原则与最近的尚未匹配then stmt匹配，根据这种原则来解决构造parsing table所产生的冲突。假设栈中的内容是if e then stmt，当前输入符号是else，则应该选择移入else来与最近的then相匹配。</li>
<li>错误处理例程（见related FA descriptions）</li>
<li>根据输出的规约序列生成语法分析树</li>
</ul>
<h1 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h1><ul>
<li>token序列仅有i，a，t，e，w，d，b，end，c，；这几种，遇到其他token字符时，错误处理例程将发出诊断信息“未标识字符”并跳过这个字符。</li>
</ul>
<h1 id="Related-FA-descriptions"><a href="#Related-FA-descriptions" class="headerlink" title="Related FA descriptions"></a>Related FA descriptions</h1><ul>
<li>LR(1) DFA</li>
</ul>
<p><img src="../images/4.jpg" alt=""></p>
<ul>
<li><p>LR(1) parsing table</p>
<p>| 状态 | ACTION |      |      |      |      | GOTO |<br>| —- | —— | —- | —- | —- | —- | —- |<br>|      | i      | ；   | e    | a    | $R   | S    |<br>| 0    | s2     | e2   | e2   | s3   | e4   | 1    |<br>| 1    | e3.1   | s4   | e2   | e3.1 | ACC  |      |<br>| 2    | s6     | e2   | e1.1 | s11  | e4   | 5    |<br>| 3    | e2     | r4   | e2   | e2   | r4   |      |<br>| 4    | s2     | e2   | e2   | s3   | e4   | 7    |<br>| 5    | e2     | r2   | s8   | e2   | r2   |      |<br>| 6    | s6     | e2   | e1.2 | s11  | e4   | 10   |<br>| 7    | e3.1   | r3   | e2   | e3.1 | r3   |      |<br>| 8    | s2     | e2   | e2   | s3   | e4   | 12   |<br>| 9    | s6     | e2   | e2   | s11  | e4   | 13   |<br>| 10   | e3.2   | r2   | s14  | e3.2 | r2   |      |<br>| 11   | e2     | r4   | r4   | e2   | r4   |      |<br>| 12   | e3.1   | r1   | e2   | e3.1 | r1   |      |<br>| 13   | e3.2   | r3   | r3   | e3.2 | r3   |      |<br>| 14   | s6     | e2   | e2   | s11  | e4   | 15   |<br>| 15   | e3.2   | r1   | r1   | e3.2 | r1   |      |</p>
</li>
<li><p>错误处理例程：</p>
<ul>
<li>e1<ul>
<li>原因：if与else之间缺少S</li>
<li>解决：输出“if与else之间为空”。如果是e1.1，则将状态5压栈，如果是e1.2，则将状态10压栈，模拟if S，来接收下一个else</li>
</ul>
</li>
<li>e2<ul>
<li>原因：不应该出现在此处的符号，与前后符号均无法配合的符号。</li>
<li>解决：输出“非法符号”，将输入流的读头前进一步</li>
</ul>
</li>
<li>e3<ul>
<li>原因：S与S中间缺少”;”</li>
<li>解决：输出“语句间缺少;”，如果是e3.1，则将状态4压栈，如果是e3.2，则将状态9压栈，模拟S；S</li>
</ul>
</li>
<li>e4<ul>
<li>原因：提前结束，直接遇到$R</li>
<li>解决：输出“语法分析提前结束，栈中的符号仍未匹配”，结束主函数，抛出异常。</li>
</ul>
</li>
</ul>
<h1 id="Important-Data-Structures"><a href="#Important-Data-Structures" class="headerlink" title="Important Data Structures"></a>Important Data Structures</h1></li>
<li><p>Action，用来描述预测分析表中的一个单元，标识了该单元的操作类型（移入，规约，错误，结束），操作序号（移入时的下一状态、规约时使用的文法号、错误时调用的错误处理例程）。</p>
</li>
<li>Grammar，用来记录一条产生式的左部和右部。</li>
<li>State，用来描述LR(1)文法中的一个DFA状态集，记录了该状态的状态号和入栈时的标识符。</li>
<li>ParsingTable，预测分析表，记录了每个状态对应的ACTION和GOTO</li>
<li><p>ParseTreeNode，分析树节点，每个节点指向自己的左子女和右兄弟，有广度优先遍历的输出节点方法。对于语法分析树T，T的高度为I，则该方法输出I行，每一行依次输出该树该层的所有子节点。</p>
<h1 id="Core-Algorithms"><a href="#Core-Algorithms" class="headerlink" title="Core Algorithms"></a>Core Algorithms</h1></li>
<li><p>通过文法的产生式构造LR(1)DFA</p>
<ul>
<li>输入：文法+S’-&gt;S的增广文法G’</li>
<li>输出：LR（1）DFA</li>
<li>方法：状态内扩展（子自动机调用）和状态间扩展，使用预测符来对需要规约的状态进行规约预测，解决s，r、r，r冲突。</li>
</ul>
</li>
<li><p>通过LR(1)DFA和错误处理例程构造预测分析表</p>
<ul>
<li>输入：LR(1)DFA和错误处理例程</li>
<li>输出：预测分析表</li>
<li>方法：根据状态间扩展关系和状态内规约情况填写预测分析表的GOTO、shift和reduce项，根据错误处理例程的分类，观察每个状态的核，每个状态的核便是该状态实际入栈时的栈内情况，比如实验中的状态1，它的核是S’-&gt;S.和S’-&gt;S.;S 所以该状态下如果忘记输入分号便会产生错误，调用错误处理例程e3.1来添加分号，将e3.1填入表中，其他错误处理例程的填写方法类似，最终错误处理例程将填充满ACTION表部分。</li>
</ul>
</li>
<li><p>结合预测分析表，接收token序列输出规约序列</p>
<ul>
<li>输入：token序列</li>
<li>输出：产生式规约序列</li>
<li>方法：建立一个状态栈，状态栈的每一个节点的状态都存储了状态号和栈顶标识符，根据读头指向的输入流和栈顶标识符决定下一状态或者下一可规约序列，中途可能有错误处理和ACC退出。</li>
</ul>
</li>
<li><p>根据规约序列产生语法分析树</p>
<ul>
<li><p>输入：规约序列</p>
</li>
<li><p>输出：语法分析树的根节点</p>
</li>
<li><p>方法：建立一个产生式栈，对规约序列中的每个产生式A，找到里面所有的S，每个S代表它的一个子节点，因此弹出栈中存储的一个节点作为它的子节点，在构造完这个A的所有子节点后，将A压入栈中。分析下一个产生式，直到规约序列的末尾，因为任何一个句子实例B所产生的规约序列中，产生式右部的S的数量正好比产生式数量少一个（把S视为子过程调用），因此此时栈中正好为空，末尾的那个产生式正好是父节点。如图：</p>
<p><img src="../images/5.jpg" alt=""></p>
</li>
</ul>
</li>
</ul>
<h1 id="Use-cases"><a href="#Use-cases" class="headerlink" title="Use cases"></a>Use cases</h1><p>  测试用例共有6组，前三组的输入为符合文法的token序列，后三组分别测试了错误例程e1，e2，e4，（因为e2的优先级高于e3，e3永远不会发生）</p>
<ol>
<li><ul>
<li><p>input：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if if a else a</span><br></pre></td></tr></table></figure>
</li>
<li><p>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">reduce list:</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;iSeS</span><br><span class="line">S-&gt;iS</span><br><span class="line"></span><br><span class="line">parse tree:</span><br><span class="line">S-&gt;iS  </span><br><span class="line">S-&gt;iSeS    </span><br><span class="line">S-&gt;a   S-&gt;a</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><ul>
<li><p>input：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if if a else a else if a</span><br></pre></td></tr></table></figure>
</li>
<li><p>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">reduce list:</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;iSeS</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;iS</span><br><span class="line">S-&gt;iSeS</span><br><span class="line"></span><br><span class="line">parse tree:</span><br><span class="line">S-&gt;iSeS	</span><br><span class="line">S-&gt;iS	S-&gt;iSeS	</span><br><span class="line">S-&gt;a	S-&gt;a	S-&gt;a</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><ul>
<li><p>input：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a ; if a ; if a else a ; if if a else a ; a</span><br></pre></td></tr></table></figure>
</li>
<li><p>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">reduce list:</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;iS</span><br><span class="line">S-&gt;S;S</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;iSeS</span><br><span class="line">S-&gt;S;S</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;iSeS</span><br><span class="line">S-&gt;iS</span><br><span class="line">S-&gt;S;S</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;S;S</span><br><span class="line"></span><br><span class="line">parse tree:</span><br><span class="line">S-&gt;S;S	</span><br><span class="line">S-&gt;a	S-&gt;S;S	</span><br><span class="line">S-&gt;iS	S-&gt;S;S	</span><br><span class="line">S-&gt;iSeS	S-&gt;S;S	</span><br><span class="line">S-&gt;a	S-&gt;a	S-&gt;iS	S-&gt;a	</span><br><span class="line">S-&gt;a	S-&gt;iSeS	S-&gt;a	S-&gt;a</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><ul>
<li><p>input：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if else a</span><br></pre></td></tr></table></figure>
</li>
<li><p>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if与else之间为空</span><br><span class="line">reduce list:</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;iSeS</span><br><span class="line"></span><br><span class="line">parse tree:</span><br><span class="line">S-&gt;iSeS	</span><br><span class="line">S-&gt;a	S-&gt;a</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><ul>
<li><p>input：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if b a else a ; if a a</span><br></pre></td></tr></table></figure>
</li>
<li><p>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">不该出现在这里的符号b</span><br><span class="line">不该出现在这里的符号a</span><br><span class="line">reduce list:</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;iSeS</span><br><span class="line">S-&gt;a</span><br><span class="line">S-&gt;iS</span><br><span class="line">S-&gt;S;S</span><br><span class="line"></span><br><span class="line">parse tree:</span><br><span class="line">S-&gt;S;S	</span><br><span class="line">S-&gt;iS	S-&gt;iSeS	</span><br><span class="line">S-&gt;a	S-&gt;a	S-&gt;a</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><ul>
<li><p>input：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if a else</span><br></pre></td></tr></table></figure>
</li>
<li><p>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法分析提前结束，栈中的符号$ if S else 仍未匹配</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ol>
<h1 id="Problems-occurred-and-related-solutions"><a href="#Problems-occurred-and-related-solutions" class="headerlink" title="Problems occurred and related solutions"></a>Problems occurred and related solutions</h1><ul>
<li><p>多叉树的层次遍历，并且要每层都换行输出。</p>
<ul>
<li><p>问题：一开始使用递归方法对多叉树进行层次遍历，但是在每一行输出树的每一层时，递归的方法会出现问题，例如：</p>
<p><img src="..\images\6.jpg" alt=""></p>
<p>A单独输出一行并递归输出B,C，B,C输出在同一行，B递归输出D，C递归输出E,F，所以D占一行，E,F占一行，无法做到每一层输出一行。</p>
</li>
<li><p>解决：</p>
<p>使用了队列的方法，每个节点存放一个当前层数，用一个变量i记录当前层数，初始将根节点入队，队列非空时，重复如下操作：</p>
<ul>
<li>从队头弹出一个节点n，如果n的层数大于i，则输出一个换行符，i+1。</li>
<li>输出n的产生式</li>
<li>如果n的左子节点n1非空，将其层数设置为n+1，入队。</li>
<li>如果n1的右兄弟节点n2非空，将其层数设置为n+1，入队，用n2替换n1，不断入队n1的右兄弟节点，直到n2为空。</li>
</ul>
<p>这样便可以进行层次遍历时每一层输出在同一行，不同层输出在不同行。</p>
</li>
</ul>
</li>
</ul>
<h1 id="feelings-and-comments"><a href="#feelings-and-comments" class="headerlink" title="feelings and comments"></a>feelings and comments</h1><ul>
<li>语法分析中的错误恢复机制是根据语言的使用方法来决定程序员所犯的错误中最有可能引起这个语法错误的那项，构造出一个适当的恢复过程，希望在一趟语法分析中尽可能多地发现错误，这一点也是编译语言相对于解释语言的优势，C语言的编译器在一次编译中会尽可能多的告诉程序员这段代码中的错误。LR（1）的错误恢复是得到当前状态下栈内的一个最长前缀，结合读头下的输入符号，来判断可能发生了哪个错误，这个方法的处理是局部的，因为预测分析表的每一项只能根据前面已有的状态发现错误，而不能预知未来，因此假如一段代码中一处发生了错误，通过预测分析的错误处理例程解决了这个错误，可能会影响到后续的代码，现在IDE的做法往往是一边编写的同时便进行着编译，在编译一个项目之前就能看到项目中发生的错误，往往还伴有推荐的可选解决方案，这是语法分析的错误恢复机制的一个进步。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/26/lexical-analyzer/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/26/lexical-analyzer/" itemprop="url">lexical analyzer实验报告</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-26T19:33:33+08:00">
                2018-10-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/基础/" itemprop="url" rel="index">
                    <span itemprop="name">基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="lexical-analyzer实验报告"><a href="#lexical-analyzer实验报告" class="headerlink" title="lexical analyzer实验报告"></a>lexical analyzer实验报告</h1><h1 id="Motivation-Aim"><a href="#Motivation-Aim" class="headerlink" title="Motivation/Aim"></a>Motivation/Aim</h1><p>本次实验所预计的目标是只需要接收一组正则表达式，和字符流，便可以产生匹配正则表达式的token序列，其中如果有某个串匹配多个正则表达式，则选择最长前缀的串作为token序列的输出。为了实现此目标，需要两个模块：lex模块，接收正则表达式组，输出DFA状态集。lexical analyzer模块：接收字符流，根据DFA状态集，输出oken序列。</p>
<h1 id="Content-description"><a href="#Content-description" class="headerlink" title="Content description"></a>Content description</h1><p>本次实验构造了一个lex词法分析器生成工具，输入一组正则表达式r，可以产生一个识别L(r)的DFA D，由此来构造一个lexical analyzer，利用lex产生的DFA和输入的字符流来产生这组字符流中匹配正则表达式的token序列。</p>
<h1 id="Methods"><a href="#Methods" class="headerlink" title="Methods"></a>Methods</h1><ul>
<li><p>lex的构造参考了《编译原理》的3.9节，涉及到的算法有：</p>
<ul>
<li>正则表达式的中缀转后缀</li>
<li>后缀正则表达式转化为正则表达式的抽象语法树</li>
<li>计算抽象语法树各位置节点的nullable，firstpos，lastpos，followpos</li>
<li>根据抽象语法树构造DFA</li>
<li>根据DFA状态集和DFAturn构造最小DFA</li>
</ul>
</li>
<li><p>补全计算nullable、firstpos、lastpos、followpos的计算规则</p>
<p>| 结点n             | nullable(n)                   | firstpos(n)                                                  | lastpos(n)                                                   | followpos                                               |<br>| —————– | —————————– | ———————————————————— | ———————————————————— | ——————————————————- |<br>| ϵ叶子节点         | true                          | null                                                         | null                                                         | null                                                    |<br>| 位置为i的叶子节点 | false                         | {i}                                                          | {i}                                                          | null                                                    |<br>| or节点n=c1\c2    | nullable(c1) or nullable(c2)  | firstpos(c1) or firstpos (c2)                                | lastpos(c1) or lastpos(c2)                                   | null                                                    |<br>| cat节点n=c1\c2   | nullable(c1) and nullable(c2) | if(nullable(c1))                           firstpos(c1) or firstpos (c2)                  else firstpos(c1) | if(nullable(c2))                           firstpos(c1) or firstpos (c2)                  else firstpos(c2) | for(i in lastpos(c1)) put firstpos(c2) in followpos(i)  |<br>| star节点n=c1*     | true                          | firstpos(c1)                                                 | lastpos(c1)                                                  | for(i in lastpos(n))    put firstpos(n) in followpos(i) |</p>
</li>
<li><p>lexical analyzer对字符流的处理采用了单字节预读的方法，从输入缓冲区取一个字符放到peek中，根据当前状态、peek和DFA决定下一状态。</p>
</li>
<li><p>错误处理：</p>
<ul>
<li><p>合法字符检查，构造了一张标识符表，可以用来检查正则表达式或者字符流中的字符是否都在处理范围内。</p>
</li>
<li><p>正则表达式出错，在第一步将中缀表达式转换为后缀表达式时，便对输入字符进行了检查，如果出错便会停止后续工作。</p>
</li>
<li>字符流出错，预读区peek检测到一个非法字符时，或者在一个非接受状态接收了不合适的字符时，会停止后续工作。</li>
</ul>
</li>
</ul>
<h1 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h1><ul>
<li><p>正则表达式中形如ab这样的简写用a&amp;b代替，后文中均用’a&amp;b’这样的写法来替代正则表达式’ab’。用’&amp;’替代连接符号。</p>
</li>
<li><p>《编译原理》中假设正则表达式的接受状态为’#’，这里经过实践后如果将接受状态都设置为’#’不会出现问题，但是尝试去掉’#’时产生了一些问题（后续说明），因此假设正则表达式的接收状态为’#’。</p>
</li>
<li>假设构造的lex只能识别’*’, ‘|’, ‘&amp;’(连接符号), ‘(‘, ‘)’ 这几种运算符和标识符表中的标识符所组成的正则表达式。</li>
<li>假设输入字符流以!结束（!后面还有字符则不做处理)</li>
<li>对于匹配多个正则表达式的情况，假设以最长前缀来进行匹配。</li>
</ul>
<h1 id="FA-descriptions"><a href="#FA-descriptions" class="headerlink" title="FA descriptions"></a>FA descriptions</h1><p>实验中的lex可以对任意只含’*’, ‘|’, ‘&amp;’, ‘(‘, ‘)’ 和标识符的正则表达式进行处理，这里选择了三组正则表达式：</p>
<ul>
<li><p>(a|b)*&amp;a&amp;b&amp;b&amp;#</p>
<p>a&amp;a&amp;a&amp;#</p>
</li>
<li><p>a&amp;a&amp;a&amp;#</p>
<p>b&amp;b&amp;b&amp;#</p>
<p>c&amp;c&amp;c&amp;#</p>
</li>
<li><p>(a|b)*&amp;a&amp;(a|b)&amp;#</p>
<p>(a|b)*&amp;a&amp;(a|b)&amp;(a|b)&amp;#</p>
<p>(a|b)*&amp;a&amp;(a|b)&amp;(a|b)&amp;(a|b)&amp;#</p>
</li>
</ul>
<p>正则表达式的语法分析树（以第一组正则表达式为例）</p>
<p><img src="..\images\2.jpg" alt="1540814346584"></p>
<p>（程序中使用Set存储DFAs，因此DFA的序号不是从开始1到结束n的，但是不影响结果）第一组正则表达式的DFA：</p>
<table>
<thead>
<tr>
<th></th>
<th>a</th>
<th>b</th>
<th>标识</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>5</td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>2</td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>2</td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>2</td>
<td>6</td>
<td>ACCEPT</td>
</tr>
<tr>
<td>5</td>
<td>7</td>
<td>3</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>2</td>
<td>6</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td>2</td>
<td>3</td>
<td>ACCEPT</td>
</tr>
<tr>
<td>8</td>
<td>1</td>
<td>6</td>
<td>START</td>
</tr>
</tbody>
</table>
<p>第二组正则表达式的DFA：</p>
<table>
<thead>
<tr>
<th></th>
<th>a</th>
<th>b</th>
<th>c</th>
<th>标识</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td></td>
<td></td>
<td>2</td>
<td></td>
</tr>
<tr>
<td>2</td>
<td></td>
<td></td>
<td>7</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td></td>
<td>4</td>
<td></td>
<td>ACCEPT</td>
</tr>
<tr>
<td>4</td>
<td></td>
<td>5</td>
<td></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td></td>
<td>10</td>
<td></td>
<td></td>
</tr>
<tr>
<td>6</td>
<td>9</td>
<td></td>
<td>7</td>
<td></td>
</tr>
<tr>
<td>7</td>
<td></td>
<td></td>
<td></td>
<td>ACCEPT</td>
</tr>
<tr>
<td>8</td>
<td>6</td>
<td>4</td>
<td>1</td>
<td>START</td>
</tr>
<tr>
<td>9</td>
<td>3</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>10</td>
<td></td>
<td></td>
<td></td>
<td>ACCEPT</td>
</tr>
</tbody>
</table>
<p>第三组正则表达式的DFA：</p>
<table>
<thead>
<tr>
<th></th>
<th>a</th>
<th>b</th>
<th>标识</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>7</td>
<td>4</td>
<td>ACCEPT</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>6</td>
<td>ACCEPT</td>
</tr>
<tr>
<td>3</td>
<td>5</td>
<td>4</td>
<td></td>
</tr>
<tr>
<td>4</td>
<td>12</td>
<td>5</td>
<td>ACCEPT</td>
</tr>
<tr>
<td>5</td>
<td>9</td>
<td>2</td>
<td>ACCEPT</td>
</tr>
<tr>
<td>6</td>
<td>3</td>
<td>6</td>
<td>START</td>
</tr>
</tbody>
</table>
<h1 id="Data-Structures"><a href="#Data-Structures" class="headerlink" title="Data Structures"></a>Data Structures</h1><ul>
<li>实验中涉及到的数据结构有Attri，DFAGroup，DFAState，NodeType，RETreeNode，Token</li>
<li>NodeType：枚举了一个节点的类型，SYNC标识终结符节点,STAR标识*节点,OR标识|节点,CAT标识&amp;节点</li>
<li>RETreeNode：构造正则分析树的节点类，存放了节点的类型，节点的位置（如果是一个位置结点），节点标识符的值，左右子节点，nullable、firstpos、lastpos、followpos这四个用来产生DFA的关系结构。</li>
<li>Attri：枚举了一个状态的类型，START标识开始状态，ACCEPT标识接受状态，SIMPLE标识一般状态</li>
<li>DFAState：存放了DFA的单个状态的状态号、状态类型、未最小化前的转换表（map）、最小化DFA的转换表（map）。</li>
<li>DFAGroup：存放了一个DFA分组，用来对DFA进行最小化，含有一个Set\<dfastate>。</dfastate></li>
<li>Token存放了分析字符流产生的词法单元。</li>
</ul>
<h1 id="Core-Algorithms"><a href="#Core-Algorithms" class="headerlink" title="Core Algorithms"></a>Core Algorithms</h1><ul>
<li><p>Lex模块：</p>
<ul>
<li><p>多个正则表达式的组合，多个正则表达式可以使用’|’串联，需要注意给每个正则表达式最外面添加一层’()’防止运算次序出错。</p>
<ul>
<li>输入：多个正则表达式的集合A</li>
<li>输出：一个组合的正则表达式</li>
<li>方法：<ul>
<li>对于A中的每个正则表达式a，添加一层’()’，添加一个’|’</li>
<li>删除最后一个’|’</li>
</ul>
</li>
</ul>
</li>
<li><p>正则表达式的中缀转后缀，原因：利用后缀表达式，可以十分方便地构造一棵正则表达式分析树。</p>
<p>正则表达式中的运算符有’|’,’<em>‘,’&amp;’,’(‘,’)’,他们的优先级为’()’&gt;’\</em>‘&gt;’&amp;’&gt;’|’。使用一个操作符栈来完成中缀转后缀的过程。：</p>
<ul>
<li>输入：一个中缀正则表达式</li>
<li>输出：该正则表达式的后缀形式</li>
<li>方法：<ul>
<li>构造一个空操作符栈</li>
<li>遇到操作数，则直接输出。</li>
<li>遇到操作符，则依次弹出A中的操作符并输出，直到栈顶出现优先级更低的操作符或者’(‘。然后压入操作符。</li>
<li>遇到’(‘，直接压栈。</li>
<li>遇到’),依次弹出栈中的操作符并输出，直到栈顶出现’(‘，弹出’(‘。</li>
<li>最后，将栈中剩余操作符依次弹出。</li>
</ul>
</li>
</ul>
</li>
<li><p>后缀正则表达式构造语法分析树（过程中同时计算各节点的nullable，firstpos，lastpos，计算方法参考Methods中的补全表）：</p>
<ul>
<li>输入：后缀正则表达式</li>
<li>输出：该正则表达式的语法分析树</li>
<li>方法：<ul>
<li>使用一个栈A作为节点寄存栈，节点里存放的是当前抽象意义上的操作数。</li>
<li>遇到一个操作数，则构造一个节点，压栈。</li>
<li>遇到’<em>‘，从栈里弹出一个节点作为\</em>的子节点，压栈。</li>
<li>遇到’|’或者’&amp;’，从栈里弹出两个节点作为它的右左节点（注意顺序），第一个弹出的是右节点，压栈。</li>
<li>如果正则表达式正确，栈中最后会剩一个节点，即整个正则分析树的根节点。</li>
</ul>
</li>
</ul>
</li>
<li><p>先序遍历正则分析树，产生所有位置节点的followpos，因为计算followpos的方法只涉及firstpos和lastpos，因此可以采用先序遍历的方法，自顶向下构造：</p>
<ul>
<li>输入：正则语法分析树</li>
<li>输出：该树位置节点的followpos</li>
<li>方法：<ul>
<li>先序遍历该树，直到最后一个节点：</li>
<li>对于cat节点，cat节点左子女的lastpos的followpos肯定包含cat节点右子女的firstpos</li>
<li>对应star节点，因为可以自环，所有自身的lastpos的followpos肯定包含自身的firstpos</li>
</ul>
</li>
</ul>
</li>
<li><p>由正则分析树构造DFA状态集</p>
<ul>
<li>输入：正则分析树</li>
<li>输出：DFA状态集和DFATurn</li>
<li>方法：<ul>
<li>构造两个状态集，已标记状态集A和未标记状态集B。</li>
<li>将根节点的firstpos作为开始状态加入未标记状态集</li>
<li>只要未标记状态集非空，便选择一个状态S将其置于标记状态集，对于每个标识符a，令U为该状态和标识符a对应的所有位置p的followpos(p)的并集，如果U不在状态集中，则将U加入到未标记状态集中，同时在S的DFATurn map中增加一条（a，U）。</li>
<li>未标记状态集为空，则已标记状态集中便是DFA的所有状态，且每个状态的DFATurn合到一起便是DFA转换表。</li>
<li>删除A中的空状态，由于算法实际编写时的缺陷，可能会产生一定数量的空状态：该状态没有任何位置节点，删去这样的空状态。</li>
</ul>
</li>
</ul>
</li>
<li><p>由DFA构造具有最少状态的DFA（与《编译原理》略有不同）：</p>
<ul>
<li><p>输入：DFA状态集和各状态的DFATurn</p>
</li>
<li><p>输出：具有最少状态的DFA和各状态的DFATurn</p>
</li>
<li><p>方法：</p>
<ul>
<li>构造一个划分A，包含两个组p和q，p是DFA的接受状态组，q是非接受状态组</li>
<li>构造一个空的新划分B</li>
<li>对于划分A中的每个组a的所有状态s，检查s能否加入到新划分的一个分组里，可以加到该分组的条件是该分组内的某个状态s1和s对于所有终结符的下一转换状态在A的同一个分组里。如果可以加入，则加入，否则，新建一个分组b，分配b的id号，将s加入分组b，将b加入到新划分B中。</li>
<li>最后，如果B和A的大小相同，则代表算法第一阶段结束，进入第二阶段，否则用B代替A，新建一个空划分代替B，重复算法第三步。</li>
<li>对于每个分组，选择一个代表状态s，将s的id号设置为该分组的id号，将s的turn状态改为原来turn状态所在其他分组的代表状态s。</li>
<li>新产生的状态s的集合即为新的DFA集，每个s有自己的DFATurn。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>lexical analyzer模块</p>
<ul>
<li><p>根据字符流和DFA产生一个token</p>
<ul>
<li><p>输入：字符流、Set\<dfastate></dfastate></p>
</li>
<li><p>输出：一个合法token</p>
</li>
<li>方法：<ul>
<li>使用一个单字节peek作为预读， 一个状态S赋值为DFA的开始状态，过滤掉空字符，对于m每个合法的peek，找到DFATurn（S，peek）将下一状态作为S，直到遇到非法字符或者#，检查S是否是接受状态，如果是接受状态，则返回这一过程中产生的这个token。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="Use-cases"><a href="#Use-cases" class="headerlink" title="Use cases"></a>Use cases</h1><p>测试用例位于test包内，共有三组，对于上述的每组正则表达式组i，构造了两个输入流Streamia，Streamib，测试时首先使用lex模块接收正则表达式组i输出DFA状态集，再调用lexical analyzer模块接收输入流，利用DFA状态集产生token序列。所以每个测试用例输出的内容有DFA和token序列。如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">DFA states</span><br><span class="line">id: 1</span><br><span class="line">type: ACCEPT</span><br><span class="line">turn :</span><br><span class="line">a: 7</span><br><span class="line">b: 4</span><br><span class="line">c: </span><br><span class="line">#: </span><br><span class="line"></span><br><span class="line">id: 2</span><br><span class="line">type: ACCEPT</span><br><span class="line">turn :</span><br><span class="line">a: 3</span><br><span class="line">b: 6</span><br><span class="line">c: </span><br><span class="line">#: </span><br><span class="line"></span><br><span class="line">id: 3</span><br><span class="line">type: SIMPLE</span><br><span class="line">turn :</span><br><span class="line">a: 5</span><br><span class="line">b: 4</span><br><span class="line">c: </span><br><span class="line">#: </span><br><span class="line"></span><br><span class="line">id: 4</span><br><span class="line">type: ACCEPT</span><br><span class="line">turn :</span><br><span class="line">a: 12</span><br><span class="line">b: 5</span><br><span class="line">c: </span><br><span class="line">#: </span><br><span class="line"></span><br><span class="line">id: 5</span><br><span class="line">type: ACCEPT</span><br><span class="line">turn :</span><br><span class="line">a: 9</span><br><span class="line">b: 2</span><br><span class="line">c: </span><br><span class="line">#: </span><br><span class="line"></span><br><span class="line">id: 6</span><br><span class="line">type: START</span><br><span class="line">turn :</span><br><span class="line">a: 3</span><br><span class="line">b: 6</span><br><span class="line">c: </span><br><span class="line">#: </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tokens on stream 3a</span><br><span class="line">aaa</span><br><span class="line">aaaa</span><br><span class="line">aaaaa</span><br><span class="line">bbaa</span><br><span class="line">bbaab</span><br><span class="line">bbaaba</span><br><span class="line"></span><br><span class="line">tokens on stream 3b</span><br><span class="line">aaabbb</span><br><span class="line">aaaaabb</span><br><span class="line">aaaaaabbab</span><br><span class="line">bbaaabb</span><br><span class="line">bbaabbb</span><br><span class="line">bbaabab</span><br></pre></td></tr></table></figure>
<h1 id="Problems-occurred-and-related-solutions"><a href="#Problems-occurred-and-related-solutions" class="headerlink" title="Problems occurred and related solutions"></a>Problems occurred and related solutions</h1><ul>
<li><p>循环结构太过复杂导致分析问题困难，如图是上述算法中的DFA-&gt;DFA with minimum states的初始版本，其中使用了5层嵌套循环，出错时调试了好久。解决方案：将该算法分解为三步，DFA-&gt;DFA with minimum states、寻找一个状态能否加入到新的划分里、判断两个状态是否属于同一划分。</p>
<p><img src="..\images\3.png" alt="1540860008570"></p>
</li>
<li><p>正则表达式以’#’为结束符，《编译原理》中在分析NFA的重要状态时说：“我们可以在一个正则表达式r的右端连接一个独特的右端结束标记符#，使得r的结束状态增加一个在#上的转换，使之成为(r)#NFA的重要状态，换句话说，通过使用扩展的正则表达式(r)#，我们可以在构造过程中不考虑接受状态的问题。当构造过程结束后，任何在#上有离开转换状态的状态必然是一个结束状态。”这一段话在手动操作时很容易实现，先增加一个#作为结束符，在最后对所有接受状态做修正即可，然而编码中没有找到可以修正接受状态的方法，因为构造最小状态集的DFA改变了与#有关的状态的转换情况，如果不增加#作为结束符，则又会因为缺少重要状态导致产生了错误的DFA，因此在最后保留了#这一结束符。这一问题《编译原理》中也没有给出“构造过程结束后，任何在#上有离开转换状态的状态必然是一个结束状态”该如何来实现，存疑。</p>
</li>
<li><p>DFA状态的最小化：《编译原理》中对DFA状态的最小化所描述的算法是不能直接拿来编程的，因为对一个划分中的每个分组，将该分组分为更小的组，这个分组的方法是通过观察法实现的，因此将该算法改良为可编程算法，（参考本文档Core Algorithms中的由DFA构造具有最少状态的DFA）取出G中的每个状态，来判断它是否能加入新划分的某个分组中，若不能加入，则新增分组。</p>
</li>
</ul>
<h1 id="Feelings-and-Comments"><a href="#Feelings-and-Comments" class="headerlink" title="Feelings and Comments"></a>Feelings and Comments</h1><ul>
<li>Lex模块结合《编译原理》完成，练习使用了多种数据结构：tree，map，set，stack，对于阅读一个算法的伪代码或者文字描述来转换成实际代码有了提升。</li>
<li>《编译原理》中的预备知识很重要，比如NFA的重要状态一节解释了为什么需要一个#作为结束状态，在设计lex时应该按照先构造(r)#的DFA，再根据#的接受状态还原r的DFA，没有遵循这一流程导致还原r困难。</li>
</ul>
<p><a href="https://github.com/PErFeCtISHiT/compiler-disassembling-assembly/tree/master/lex" target="_blank" rel="noopener">项目源码</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/12/数据库设计-移动运营商业务数据库说明文档/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/12/数据库设计-移动运营商业务数据库说明文档/" itemprop="url">数据库设计-移动运营商业务数据库</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-12T13:05:34+08:00">
                2018-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/基础/" itemprop="url" rel="index">
                    <span itemprop="name">基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="项目介绍"><a href="#项目介绍" class="headerlink" title="项目介绍"></a>项目介绍</h1><ul>
<li>实现内容：使用MySQL关系型数据库，设计关于运营商数据库的所有表，使用java代码生成测试数据，对测试数据进行查找测试</li>
<li>开发平台：IntelliJ IDEA Ultimate，MySQL Workbench 6.3 CE</li>
<li>使用技术：java、hibernate orm架构、mysql、spring boot、jpa、</li>
<li>设计模式：模板模式</li>
<li>项目地址：<a href="https://github.com/PErFeCtISHiT/database-exercise" target="_blank" rel="noopener">运营商数据库</a></li>
</ul>
<h1 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h1><ul>
<li><p>创建数据库并授予权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">create database businessDB</span><br><span class="line">grant all privileges on businessDB.* to user@localhost identified by &apos;password′;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<ul>
<li><p>采用hbm2ddl 来定义数据库结构，ddl是一种sql语言，用来定义数据库的结构，如建立一张表，创建一个数据库，hbm2ddl是hibernate框架用来自动创建|更新|验证数据库表结构的一个工具。第一次加载hibernate时根据model类会自动建立起表的结构（前提是先建立好数据库），以后加载hibernate时根据model类自动更新表结构，即使表结构改变了但表中的行仍然存在不会删除以前的行。具体创建方法是hibernate去根据java代码中的Entity类创建数据表。</p>
</li>
<li><p>数据库可以通过dbscript.sql文件来生成，dbscript.sql文件是项目完成后生成的源数据脚本。实现了建表和测试数据生成。</p>
</li>
<li><p>数据库ER图：</p>
<p><img src="..\images\1540270255808.png" alt="54027025580"></p>
<ul>
<li>user表记录了用户的id，当月通话时间、短信条数、国内外流量使用</li>
<li>user_discount是一张关联表，记录了user_id，discount_id，反应用户当前套餐的关系（退订会影响该表）（不同套餐可以叠加）</li>
<li>discount记录了套餐的id，名称，功能费，通话时间、短信条数、国内外流量。</li>
<li>user_order记录了订单的id、user_id（外键）、discount_id（外键）、订购时间，记录的是用户订购套餐的历史（退订不会影响该表）</li>
<li>bill记录了月账单的id、日期、通话时间、短信条数、国内外流量、user_id（外键）、通话资费、信息资费、本地流量资费、全国流量资费。其中各项资费均记录套餐外产生的资费。</li>
<li>flow_record记录了流量记录的id，日期，国内外流量，资费。</li>
<li>call_record记录了通话记录的id，日期，通话时长，资费。</li>
</ul>
</li>
<li><p>资费设计,因为优惠套餐可以叠加，所以超出套餐部分按照基准资费计算，优惠套餐本身不考虑超出后计费问题。</p>
<ul>
<li><p>基准资费</p>
<ul>
<li>通话费用：0.5元/分钟（仅拨打收费，接听免费）</li>
<li>短信费用：0.1元/条</li>
<li>本地流量费用（仅考虑4G流量）：2元/M</li>
<li>国内流量费用（仅考虑4G流量）：5元/M</li>
</ul>
</li>
<li><p>优惠套餐</p>
<ul>
<li>话费套餐：月功能费20元，最多可拨打100分钟电话</li>
<li>短信套餐：月功能费10元，最多可发送200条短信</li>
<li>本地流量套餐：月功能费20元，最多可获得2G流量，仅在本地使用</li>
<li>国内流量套餐：月功能费30元，最多可获得2G流量。</li>
<li>混合套餐：月功能费40元，最多可拨打50分钟电话，发生100条短信，获得1G本地流量，1G国内流量（多种优惠）</li>
</ul>
<p>​</p>
</li>
</ul>
</li>
<li><p>后端使用ORM架构，利用OneToMany，ManyToOne，ManyToMany等完成表之间的映射关系。例如：<img src="..\images\1539326429599.png" alt="53932642959"></p>
</li>
</ul>
<h1 id="后端实现"><a href="#后端实现" class="headerlink" title="后端实现"></a>后端实现</h1><h1 id="测试数据生成"><a href="#测试数据生成" class="headerlink" title="测试数据生成"></a>测试数据生成</h1><p>先分析一段导出的sql脚本</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user`</span>;</span><br><span class="line"><span class="comment">/*!40101 SET @saved_cs_client     = @@character_set_client */</span>;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = utf8 */</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`call_month`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`internal_flow_month`</span> <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`local_flow_month`</span> <span class="keyword">double</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`message_month`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">3</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"><span class="comment">/*!40101 SET character_set_client = @saved_cs_client */</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- Dumping data for table `user`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">LOCK</span> <span class="keyword">TABLES</span> <span class="string">`user`</span> WRITE;</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `user` DISABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`user`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>,<span class="number">150</span>,<span class="number">200</span>,<span class="number">5000</span>,<span class="number">260</span>),(<span class="number">2</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line"><span class="comment">/*!40000 ALTER TABLE `user` ENABLE KEYS */</span>;</span><br><span class="line"><span class="keyword">UNLOCK</span> <span class="keyword">TABLES</span>;</span><br></pre></td></tr></table></figure>
<p>插入数据的基本操作便是占用写锁、插入数据、释放写锁。编写testDataGenerator类来产生测试数据（基本表各10万条，关联表视情况而定），将测试数据写入若干sql文件中，在mysql控制台运行该脚本便生成了测试数据。</p>
<p><img src="..\images\1539421717594.png" alt="53942171759"></p>
<p>插入20万条数据：</p>
<p><img src="..\images\1539423180784.png" alt="53942318078"></p>
<h2 id="模板模式"><a href="#模板模式" class="headerlink" title="模板模式"></a>模板模式</h2><p><strong>意图：</strong>定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。模板方法使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p>
<p><strong>主要解决：</strong>一些方法通用，却在每一个子类都重新写了这一方法。</p>
<p><strong>使用场景：</strong> 1、有多个子类共有的方法，且逻辑相同。 2、重要的、复杂的方法，可以考虑作为模板方法。</p>
<p>在设计数据库服务类时，便使用到了模板模式，不管是那张表，因为jpa对操作进行了封装，可以利用object进行操作，因此对数据库的操作有一部分是相同的，如根据primary key查找，新增，修改，删除，统计个数，判断是否存在，清空表。在设计中建立抽象类PublicService，声明了一个泛型JpaRepository以及上述方法，所有继承PublicService的类都要去自己定义自己的JpaRepository，之后，便可以直接复用父类的方法。减少重复代码。</p>
<p><img src="C:\hexo\source\images\1539601810131.png" alt="53960181013"></p>
<h2 id="数据库相关操作"><a href="#数据库相关操作" class="headerlink" title="数据库相关操作"></a>数据库相关操作</h2><p>Main.java每次运行会在10万名用户中抽取10名，查询当前套餐，查询历史套餐，订购套餐1，退订套餐1（立即生效或下个月生效），生成通话资费，生成流量资费，查询月账单，经测试，平均每个操作约耗时100毫秒，最多的耗时为1000毫秒。</p>
<ul>
<li><p>对某个用户进行套餐的查询（包括历史记录），使用@ManyToMany进行user表与discount表的关联映射，当需要加载某个用户的Set<discountentity> discountEntities时，hibernate通过lazy initialize去查找这个用户的discount，历史记录同理，建立ures与order表的关联映射，Set<orderentity> orderEntities记录了用户的历史记录。</orderentity></discountentity></p>
<p><img src="C:\hexo\source\images\1539604919402.png" alt="53960491940"></p>
</li>
<li><p>订购、退订（考虑立即生效和次月生效）操作，订购套餐即先lazy initialize某个用户的所有套餐，再在这个set里添加一项，通过jpa封装的modify将事务提交至mysql数据库，退订同理，次月生效的退订使用了java的TimerTask类来进行延时处理。</p>
<p><img src="C:\hexo\source\images\1539604942442.png" alt="53960494244"></p>
</li>
<li><p>某个用户在通话情况下的资费生成，得到用户当月的套餐，计算出套餐外的通话量，产生通话记录。</p>
<p><img src="..\images\1540271700389.png" alt="54027170038"></p>
</li>
<li><p>某个用户在使用流量情况下的资费生成，同上。</p>
<p><img src="..\images\1540272388161.png" alt="54027238816"></p>
</li>
<li><p>某个用户月账单的生成，用户信息中记录了用户当月的各类服务使用量，user与discount表关联得到了用户的优惠套餐，用使用量减去优惠套餐得到了优惠套餐之外的额外消费，产生月账单记录。</p>
<p><img src="C:\hexo\source\images\1539604997520.png" alt="53960499752"></p>
</li>
</ul>
<h1 id="项目回顾"><a href="#项目回顾" class="headerlink" title="项目回顾"></a>项目回顾</h1><ul>
<li><p>设计方案</p>
<ul>
<li>用户套餐关系中，使用了两张表user_discount和user_order来反应不同的关系，前者反应用户当前的套餐，后者反应套餐历史，而不是选择使用一张表来记录用户的所有套餐，再用一个标志位来区分是当前套餐还是套餐历史，是考虑到了时间效率，因为用户更加经常做的事情是去查看自己当前的套餐情况，如果使用一张表的设计，查询所有的套餐历史再去筛选当前套餐，会影响数据库效率，用户当前的套餐数量远小于历史套餐数量。（两张表代替一张表，空间换取时间）</li>
<li>用户账单关系中，考虑到需要的操作：某个用户在通话情况下的资费生成、某个用户在使用流量情况下的资费生成、某个用户月账单的生成，应该设计三个表：用户通话总资费，用户流量总资费、用户月账单总资费，但是这样设计会加重与数据库交互的后端的任务，因为每当月底生成月账单时，后端要记得去三个表里修改数据，用户的通话增加了，流量增加了，月账单也要更新，如果这样设计数据库，在月底结账那一天数据库的负担会很大，要更新三张表里面许多的冗余数据，因此这里只设计了一张表，即用户月账单，用户通话的总资费可以去将所有月账单的通话累积，流量同理，这样设计带来的问题是获取用户通话总资费会进行更多的查询操作，但是这样可以将负担分配到每一天，因为这几个操作是随机进行的，而不像月底结账一样数据量繁重。牺牲单个用户进行某个操作的效率换取了对全体用户维持三个表带来的负担。（一张表代替三张表，分散数据库压力）</li>
</ul>
</li>
<li><p>遇到的问题</p>
<ul>
<li><p>LazyInitializationException，曾经遇到过这个问题，没有做深入了解便轻易将fetchtype换成eager，对于小数据量来说是一个解决方案，然而这个项目中设计了10万条测试，遇到这个异常时我把所有的fetchtype都换成了eager，急加载所有数据，换来的代价就是查找一个记录需要一分多钟，将sql内容输出到日志才发现，如果要查找某个用户和他的所有套餐，原先的操作可能是</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> userentity0_.id <span class="keyword">as</span> id1_2_0_, userentity0_.call_month <span class="keyword">as</span> call_mon2_2_0_, userentity0_.internal_flow_month <span class="keyword">as</span> internal3_2_0_, userentity0_.local_flow_month <span class="keyword">as</span> local_fl4_2_0_, userentity0_.message_month <span class="keyword">as</span> message_5_2_0_ <span class="keyword">from</span> <span class="keyword">user</span> userentity0_ <span class="keyword">where</span> userentity0_.id=?</span><br><span class="line"><span class="keyword">select</span> discounten0_.user_entities_id <span class="keyword">as</span> user_ent1_4_0_, discounten0_.discount_entities_id <span class="keyword">as</span> discount2_4_0_, discounten1_.id <span class="keyword">as</span> id1_1_1_, discounten1_.call_count <span class="keyword">as</span> call_cou2_1_1_, discounten1_.internal_flow <span class="keyword">as</span> internal3_1_1_, discounten1_.local_flow <span class="keyword">as</span> local_fl4_1_1_, discounten1_.message_count <span class="keyword">as</span> message_5_1_1_, discounten1_.discount_name <span class="keyword">as</span> discount6_1_1_, discounten1_.price <span class="keyword">as</span> price7_1_1_ <span class="keyword">from</span> user_discount discounten0_ <span class="keyword">inner</span> <span class="keyword">join</span> discount discounten1_ <span class="keyword">on</span> discounten0_.discount_entities_id=discounten1_.id <span class="keyword">where</span> discounten0_.user_entities_id=?</span><br></pre></td></tr></table></figure>
<p>，先找到这个用户，再去找他跟其他表的关联，由于使用了急加载，所有跟user有关的表都被先查询，在筛选用户之前，便对10万个用户与他们的10万条优惠套餐做了笛卡儿积，最终所有操作加起来用时超过了三分钟，产生了近百兆的日志文件，lazy initialize允许加载一个对象时先不加载这个对象的这个属性，当使用它时，hibernate再去数据库获取，在数据量相当大时比eager initialize的性能要有显著优化。解决LazyInitializationException的方法则是使用@Transactional注解去管理事务。</p>
</li>
</ul>
</li>
<li><p>主键索引</p>
<p>由于设计中对数据库的操作可以通过查询主键+表的关联映射来实现，使用lazy initialize可以在数据量较大的时候先定位到需要找的几个元素，再针对这几个元素关联查找，所有的查询语句都建立在仅查询主键的情况下完成，在建表时便建立好了主键索引，因此项目中的所有查询操作均是在索引结构中完成的。</p>
</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/09/IDA-pro 第一次反汇编/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/09/IDA-pro 第一次反汇编/" itemprop="url">IDA-pro</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-09T19:48:14+08:00">
                2018-10-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/逆向工程/" itemprop="url" rel="index">
                    <span itemprop="name">逆向工程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>The official line is: IDA Pro combines an interactive, programmable, multi-processor<br>disassembler coupled to a local and remote debugger and augmented by a complete plugin<br>programming environment. </p>
<h1 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h1><p>参考官方教程：</p>
<p><a href="https://www.hex-rays.com/products/ida/support/tutorials/debugging_win32.pdf" target="_blank" rel="noopener">Using IDA Pro&amp;s Debugger</a></p>
<p>从一段代码开始：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">char</span> <span class="title">char_average</span><span class="params">(<span class="keyword">char</span> <span class="built_in">array</span>[], <span class="keyword">int</span> count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">int</span> i;</span><br><span class="line"> <span class="keyword">char</span> average;</span><br><span class="line"> average = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line"> average += <span class="built_in">array</span>[i];</span><br><span class="line"> average /= count;</span><br><span class="line"> <span class="keyword">return</span> average;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">int_average</span><span class="params">(<span class="keyword">int</span> <span class="built_in">array</span>[], <span class="keyword">int</span> count)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"> <span class="keyword">int</span> i, average;</span><br><span class="line"> average = <span class="number">0</span>;</span><br><span class="line"> <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line"> average += <span class="built_in">array</span>[i];</span><br><span class="line"> average /= count;</span><br><span class="line"> <span class="keyword">return</span> average;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line"> <span class="keyword">char</span> chars[] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line"> <span class="keyword">int</span> integers[] = &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">"chars[] - average = %d\n"</span>,</span><br><span class="line"> char_average(chars, <span class="keyword">sizeof</span>(chars)));</span><br><span class="line"> <span class="built_in">printf</span>(<span class="string">"integers[] - average = %d\n"</span>,</span><br><span class="line"> int_average(integers, <span class="keyword">sizeof</span>(integers)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有两个求char数组与int数组均值的函数，具体过程十分简单，然而运行这段代码就会发现int_average这个函数出了问题，如果不用IDA-pro去直接调试也很容易发现问题：sizeof(integers)计算的是这个数组的大小（以字节为单位），因此传递的参数出了问题。下面开始使用IDA-pro。</p>
<p>因为IDA是一款反汇编软件，这里选择open一个生成好的.exe可执行映像（如图）</p>
<p><img src="..\images\1539167453853.png" alt="53916745385"></p>
<p>这里显示文本的方式与官方文档中不同，可以在右边空白位置右击选择text view就可以得到正常的显示，然后可以看到，IDA对.exe文件进行了反汇编（事后也试过对.jar进行反汇编，然而产生的代码根本看不懂。。。）。可以很清楚的看到几个函数块都被IDA检测到，当你想知道一个地址上下左右都是什么值，或者这个寄存器目前的值是什么时，只需要将鼠标移动到该变量处（这功能好强大），接下来就是跟其他IDE一样的操作，设置断点，调试，官方文档中的调试可以看到view-EIP（代码执行处），view-ESP（栈），如果没有显示的部分可以在windows下面找到general registers，打开对应的register view就ok了。</p>
<p><img src="..\images\1539139488272.png" alt="53913948827"></p>
<p>这里可以看到在代码的00401575h处，编译器将14h放入参数列表，这个14h就是前面的sizeof(integers) （20），后面还很贴心地给出了注释（count），也就找到了问题所在，这里不知道这个20是怎么计算出来的，可能经过了编译优化，直接将一个20立即数作为了参数。IDA对汇编语言的处理能力和反汇编是我用过的里面最好用的一款（然而到现在也就用过这一款233333）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/09/windows程序设计/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/sf.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="somnus">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/09/windows程序设计/" itemprop="url">windows程序设计</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-09T19:47:45+08:00">
                2018-10-09
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/逆向工程/" itemprop="url" rel="index">
                    <span itemprop="name">逆向工程</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/sf.png" alt="John Doe">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
